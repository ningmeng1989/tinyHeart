function game(){init(),lastTime=Date.now(),deltaTime=0,gameloop()}function init(){can1=document.getElementById("canvas1"),ctx1=can1.getContext("2d"),can2=document.getElementById("canvas2"),ctx2=can2.getContext("2d"),ctx1.font="30px Verdana",ctx1.textAlign="center",can1.addEventListener("mousemove",onMouseMove,!1),canWidth=can1.width,canHeight=can1.height,bgPic.src="./imgs/background.jpg",ane=new aneObj,ane.init(),fruit=new fruitObj,fruit.init(),mom=new momObj,mom.init(),baby=new babyObj,baby.init(),mx=.5*canWidth,my=.5*canHeight;for(var t=0;t<8;t++)babyTail[t]=new Image,babyTail[t].src="./imgs/babyTail"+t+".png";for(var t=0;t<2;t++)babyEye[t]=new Image,babyEye[t].src="./imgs/babyEye"+t+".png";for(var t=0;t<20;t++)babyBody[t]=new Image,babyBody[t].src="./imgs/babyFade"+t+".png";for(var t=0;t<8;t++)momTail[t]=new Image,momTail[t].src="./imgs/bigTail"+t+".png";for(var t=0;t<2;t++)momEye[t]=new Image,momEye[t].src="./imgs/bigEye"+t+".png";for(var t=0;t<8;t++)momBodyOra[t]=new Image,momBodyBlue[t]=new Image,momBodyOra[t].src="./imgs/bigSwim"+t+".png",momBodyBlue[t].src="./imgs/bigSwimBlue"+t+".png";for(var t=0;t<7;t++)dustPic[t]=new Image,dustPic[t].src="./imgs/dust"+t+".png";data=new dataObj,wave=new waveObj,halo=new haloObj,dust=new dustObj,dust.init()}function gameloop(){requestAnimationFrame(gameloop);var t=Date.now();deltaTime=t-lastTime,lastTime=t,deltaTime>40&&(deltaTime=40),drawBackground(),ane.draw(),fruitMonitor(),fruit.draw(),ctx1.clearRect(0,0,canWidth,canHeight),mom.draw(),baby.draw(),momFruitCollision(),momBabyCollision(),data.draw(),wave.draw(),halo.draw(),dust.draw()}function onMouseMove(t){data.gameOver||(t.offsetX||t.layerX)&&(mx=void 0==t.offsetX?t.layerX:t.offsetX,my=void 0==t.offsetY?t.layerY:t.offsetY)}function calLength2(t,i,a,e){return Math.pow(t-a,2)+Math.pow(i-e,2)}function randomColor(){var t=[0,1,2];t[0]=100*Math.random()+155,t[0]=t[0].toFixed(),t[1]=100*Math.random()+155,t[1]=t[1].toFixed(),t[2]=100*Math.random()+155,t[2]=t[2].toFixed();var i=Math.floor(3*Math.random());return t[i]=0,"rgba("+t[0]+","+t[1]+","+t[2]+","}function lerpAngle(t,i,a){var e=i-t;return e>Math.PI&&(e-=2*Math.PI),e<-Math.PI&&(e+=2*Math.PI),t+e*a}function lerpDistance(t,i,a){var e=i-t;return t+e*a}function inOboundary(t,i,a,e,o,r){return t>a&&t<e&&i>o&&i<r}function rgbColor(t,i,a){return t=Math.round(256*t),i=Math.round(256*i),a=Math.round(256*a),"rgba("+t+","+i+","+a+",1)"}function rgbNum(t,i,a){return t=Math.round(256*t),i=Math.round(256*i),a=Math.round(256*a),"rgba("+t+","+i+","+a}function rnd(t){var i=t||1;return Math.random()*i}function rateRandom(t,i){for(var a=0,e=1;e<i-t;e++)a+=e;for(var o=Math.random()*a,e=1;e<i-t;e++)if(o-=e,o<0)return e-1+t}function distance(t,i,a,e,o){var r=Math.abs(t-a),n=Math.abs(i-e);return r<o&&n<o}function AABBbox(t,i,a,e,o,r,n){return A1=t.x+n,B1=t.x+i-n,C1=t.y+n,D1=t.y+a-n,A2=e.x+n,B2=e.x+o-n,C2=e.y+n,D2=e.y+r-n,!(A1>B2||B1<A2||C1>D2||D1<C2)}function dis2(t,i,a,e){var o=t-a,r=i-e;return o*o+r*r}function rndi2(t,i){var a=Math.random()*(i-t)+t;return Math.floor(a)}function drawBackground(){ctx2.drawImage(bgPic,0,0,canWidth,canHeight)}function fruitMonitor(){for(var t=0,i=0;i<fruit.num;i++)fruit.alive[i]&&t++;if(t<15)return void sendFruit()}function sendFruit(){for(var t=0;t<fruit.num;t++)if(!fruit.alive[t])return void fruit.born(t)}function momFruitCollision(){if(!data.gameOver)for(var t=0;t<fruit.num;t++)if(fruit.alive[t]){var i=calLength2(fruit.x[t],fruit.y[t],mom.x,mom.y);i<900&&(fruit.dead(t),data.fruitNum++,mom.momBodyCount++,mom.momBodyCount>7&&(mom.momBodyCount=7),"blue"===fruit.fruitType[t]?data.double=2:data.double=1,wave.born(fruit.x[t],fruit.y[t]))}}function momBabyCollision(){var t=calLength2(mom.x,mom.y,baby.x,baby.y);data.fruitNum>0&&!data.gameOver&&t<900&&(baby.babyBodyCount=0,mom.momBodyCount=0,data.addScore(),halo.born(baby.x,baby.y))}var can1,can2,ctx1,ctx2,lastTime,deltaTime,bgPic=new Image,canWidth,canHeight,ane,fruit,mom,baby,mx,my,babyTail=[],babyEye=[],babyBody=[],momTail=[],momEye=[],momBodyBlue=[],momBodyOra=[],data,wave,halo,dust,dustPic=[];document.body.onload=game,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){return window.setTimeout(t,1e3/60)}}();var aneObj=function(){this.rootx=[],this.headx=[],this.heady=[],this.amp=[],this.alpha=0};aneObj.prototype.num=50,aneObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.rootx[t]=16*t+20*Math.random(),this.headx[t]=this.rootx[t],this.heady[t]=canHeight-250+50*Math.random(),this.amp[t]=50*Math.random()+50},aneObj.prototype.draw=function(){this.alpha+=8e-4*deltaTime;var t=Math.sin(this.alpha);ctx2.save(),ctx2.globalAlpha=.6,ctx2.lineWidth=20,ctx2.lineCap="round",ctx2.strokeStyle="#3b154e";for(var i=0;i<this.num;i++)ctx2.beginPath(),this.headx[i]=this.rootx[i]+this.amp[i]*t,ctx2.moveTo(this.rootx[i],canHeight),ctx2.quadraticCurveTo(this.rootx[i],canHeight-100,this.headx[i],this.heady[i]),ctx2.stroke();ctx2.restore()};var fruitObj=function(){this.alive=[],this.x=[],this.y=[],this.l=[],this.aneNO=[],this.spd=[],this.fruitType=[],this.orange=new Image,this.blue=new Image};fruitObj.prototype.num=30,fruitObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.alive[t]=!1,this.x[t]=0,this.y[t]=0,this.l[t]=0,this.spd[t]=.017*Math.random()+.003,this.fruitType[t]="";this.orange.src="./imgs/fruit.png",this.blue.src="./imgs/blue.png"},fruitObj.prototype.draw=function(){for(var t=0;t<this.num;t++)if(this.alive[t]){if("orange"==this.fruitType[t])var i=this.orange;else var i=this.blue;this.l[t]<=14?(this.l[t]+=this.spd[t]*deltaTime,this.x[t]=ane.headx[this.aneNO[t]],this.y[t]=ane.heady[this.aneNO[t]]):this.y[t]-=7*this.spd[t]*deltaTime,ctx2.drawImage(i,this.x[t]-.5*this.l[t],this.y[t]-.5*this.l[t],this.l[t],this.l[t]),this.y[t]<10&&(this.alive[t]=!1)}},fruitObj.prototype.born=function(t){this.aneNO[t]=Math.floor(Math.random()*ane.num),this.l[t]=0,this.alive[t]=!0;var i=Math.random();i<.7?this.fruitType[t]="orange":this.fruitType[t]="blue"},fruitObj.prototype.dead=function(t){this.alive[t]=!1};var momObj=function(){this.x,this.y,this.angle,this.momTailTimer=0,this.momTailCount=0,this.momEyeTimer=0,this.momEyeCount=0,this.momEyeInterval=1e3,this.momBodyCount=0};momObj.prototype.init=function(){this.x=.5*canWidth,this.y=.5*canHeight,this.angle=0},momObj.prototype.draw=function(){this.x=lerpDistance(mx,this.x,.99),this.y=lerpDistance(my,this.y,.99);var t=my-this.y,i=mx-this.x,a=Math.atan2(t,i)+Math.PI;this.angle=lerpAngle(a,this.angle,.6),this.momTailTimer+=deltaTime,this.momTailTimer>50&&(this.momTailCount=(this.momTailCount+1)%8,this.momTailTimer%=50),this.momEyeTimer+=deltaTime,this.momEyeTimer>this.momEyeInterval&&(this.momEyeCount=(this.momEyeCount+1)%2,this.momEyeTimer%=this.momEyeInterval,0===this.momEyeCount?this.momEyeInterval=1500*Math.random()+2e3:this.momEyeInterval=200),ctx1.save(),ctx1.translate(this.x,this.y),ctx1.rotate(this.angle);var e=this.momTailCount,o=this.momEyeCount,r=this.momBodyCount;ctx1.drawImage(momEye[o],.5*-momEye[o].width,.5*-momEye[o].height),1===data.double?ctx1.drawImage(momBodyOra[r],.5*-momBodyOra[r].width,.5*-momBodyOra[r].height):ctx1.drawImage(momBodyBlue[r],.5*-momBodyBlue[r].width,.5*-momBodyBlue[r].height),ctx1.drawImage(momTail[e],.5*-momTail[e].width+30,.5*-momTail[e].height),ctx1.restore()};var babyObj=function(){this.x,this.y,this.angle,this.babyTailTimer=0,this.babyTailCount=0,this.babyEyeTimer=0,this.babyEyeCount=0,this.babyEyeInterval=1e3,this.babyBodyTimer=0,this.babyBodyCount=0};babyObj.prototype.init=function(){this.x=.5*canWidth-50,this.y=.5*canHeight-50,this.angle=0},babyObj.prototype.draw=function(){this.x=lerpDistance(mom.x,this.x,.98),this.y=lerpDistance(mom.y,this.y,.98);var t=mom.y-this.y,i=mom.x-this.x,a=Math.atan2(t,i)+Math.PI;this.angle=lerpAngle(a,this.angle,.6),this.babyTailTimer+=deltaTime,this.babyTailTimer>50&&(this.babyTailCount=(this.babyTailCount+1)%8,this.babyTailTimer%=50),this.babyEyeTimer+=deltaTime,this.babyEyeTimer>this.babyEyeInterval&&(this.babyEyeCount=(this.babyEyeCount+1)%2,this.babyEyeTimer%=this.babyEyeInterval,0===this.babyEyeCount?this.babyEyeInterval=1500*Math.random()+2e3:this.babyEyeInterval=200),this.babyBodyTimer+=deltaTime,this.babyBodyTimer>300&&(this.babyBodyCount+=1,this.babyBodyTimer%=300,this.babyBodyCount>19&&(this.babyBodyCount=19,data.gameOver=!0)),ctx1.save(),ctx1.translate(this.x,this.y),ctx1.rotate(this.angle);var e=this.babyTailCount,o=this.babyEyeCount,r=this.babyBodyCount;ctx1.drawImage(babyTail[e],.5*-babyTail[e].width+23,.5*-babyTail[e].height),ctx1.drawImage(babyBody[r],.5*-babyBody[r].width,.5*-babyBody[r].height),ctx1.drawImage(babyEye[o],.5*-babyEye[o].width,.5*-babyEye[o].height),ctx1.restore()};var dataObj=function(){this.fruitNum=0,this.double=1,this.score=0,this.gameOver=!1,this.alpha=0};dataObj.prototype.reset=function(){},dataObj.prototype.draw=function(){var t=can1.width,i=can1.height;ctx1.save(),ctx1.shadowBlur=10,ctx1.shadowColor="white",ctx1.fillStyle="white",ctx1.fillText("SCORE:"+this.score,.5*t,i-20),this.gameOver&&(this.alpha+=5e-4*deltaTime,this.alpha>=1&&(this.alpha=1),ctx1.fillStyle="rgba(255,255,255,"+this.alpha+")",ctx1.fillText("GAME OVER",.5*t,.5*i)),ctx1.restore()},dataObj.prototype.addScore=function(){this.score+=100*this.fruitNum*this.double,this.fruitNum=0,this.double=1};var waveObj=function(){this.x=[],this.y=[],this.alive=[],this.r=[]};waveObj.prototype.num=10,waveObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.alive[t]=!1,this.r[t]=0},waveObj.prototype.draw=function(){ctx1.save(),ctx1.lineWidth=2,ctx1.shadowBlur=10,ctx1.shadowColor="white";for(var t=0;t<this.num;t++)if(this.alive[t]){if(this.r[t]+=.04*deltaTime,this.r[t]>50){this.alive[t]=!1;break}var i=1-this.r[t]/50;ctx1.beginPath(),ctx1.arc(this.x[t],this.y[t],this.r[t],0,2*Math.PI),ctx1.closePath(),ctx1.strokeStyle="rgba(255,255,255,"+i+")",ctx1.stroke()}ctx1.restore()},waveObj.prototype.born=function(t,i){for(var a=0;a<this.num;a++)if(!this.alive[a])return this.x[a]=t,this.y[a]=i,this.alive[a]=!0,void(this.r[a]=10)};var haloObj=function(){this.x=[],this.y=[],this.alive=[],this.r=[]};haloObj.prototype.num=5,haloObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.x[t]=0,this.y[t]=0,this.alive[t]=!1,this.r[t]=0},haloObj.prototype.draw=function(){ctx1.save(),ctx1.lineWidth=2,ctx1.shadowBlur=10,ctx1.shadowColor="rgba(203.91.0,1)";for(var t=0;t<this.num;t++)if(this.alive[t]){if(this.r[t]+=.05*deltaTime,this.r[t]>100){this.alive[t]=!1;break}var i=1-this.r[t]/100;ctx1.beginPath(),ctx1.arc(this.x[t],this.y[t],this.r[t],0,2*Math.PI),ctx1.closePath(),ctx1.strokeStyle="rgba(203,91,0,"+i+")",ctx1.stroke()}ctx1.restore()},haloObj.prototype.born=function(t,i){for(var a=0;a<this.num;a++)this.alive[a]||(this.x[a]=t,this.y[a]=i,this.alive[a]=!0,this.r[a]=10)};var dustObj=function(){this.x=[],this.y=[],this.amp=[],this.NO=[],this.alpha};dustObj.prototype.num=30,dustObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.x[t]=Math.random()*canWidth,this.y[t]=Math.random()*canHeight,this.amp[t]=20+25*Math.random(),this.NO[t]=Math.floor(7*Math.random());this.alpha=0},dustObj.prototype.draw=function(){this.alpha+=8e-4*deltaTime;for(var t=Math.sin(this.alpha),i=0;i<this.num;i++){var a=this.NO[i];ctx1.drawImage(dustPic[a],this.x[i]+this.amp[i]*t,this.y[i])}};