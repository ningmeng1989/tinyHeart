function game(){init(),lastTime=Date.now(),deltaTime=0,gameloop()}function init(){can1=document.getElementById("canvas1"),ctx1=can1.getContext("2d"),can2=document.getElementById("canvas2"),ctx2=can2.getContext("2d"),canWidth=can1.width,canHeight=can1.height,ctx1.font="30px Verdana",ctx1.textAlign="center",can1.addEventListener("mousemove",onMouseMove,!1),mx=.5*canWidth,my=.5*canHeight,play_again_btn=document.getElementById("play_again"),bgPic.src="assets/imgs/background.jpg";for(var t=0;t<8;t++)babyTail[t]=new Image,babyTail[t].src="assets/imgs/babyTail"+t+".png";for(var t=0;t<2;t++)babyEye[t]=new Image,babyEye[t].src="assets/imgs/babyEye"+t+".png";for(var t=0;t<20;t++)babyBody[t]=new Image,babyBody[t].src="assets/imgs/babyFade"+t+".png";for(var t=0;t<8;t++)momTail[t]=new Image,momTail[t].src="assets/imgs/bigTail"+t+".png";for(var t=0;t<2;t++)momEye[t]=new Image,momEye[t].src="assets/imgs/bigEye"+t+".png";for(var t=0;t<8;t++)momBodyOra[t]=new Image,momBodyBlue[t]=new Image,momBodyOra[t].src="assets/imgs/bigSwim"+t+".png",momBodyBlue[t].src="assets/imgs/bigSwimBlue"+t+".png";for(var t=0;t<7;t++)dustPic[t]=new Image,dustPic[t].src="assets/imgs/dust"+t+".png";ane=new aneObj,ane.init(),fruit=new fruitObj,fruit.init(),dust=new dustObj,dust.init(),wave=new waveObj,halo=new haloObj,mom=new momObj,baby=new babyObj,data=new dataObj,resetGame()}function resetGame(){mom.init(),baby.init(),data.reset()}function play_again_show(){play_again_btn.className="show",play_again_btn.addEventListener("click",play_again_exec,!1)}function play_again_exec(){play_again_btn.className="",play_again_btn.removeEventListener("click",play_again_exec),resetGame()}function gameloop(){requestAnimationFrame(gameloop);var t=Date.now();deltaTime=t-lastTime,lastTime=t,deltaTime>40&&(deltaTime=40),ctx2.clearRect(0,0,canWidth,canHeight),drawBackground(),ane.draw(),dust.draw(),fruitMonitor(),fruit.draw(),ctx1.clearRect(0,0,canWidth,canHeight),mom.draw(),baby.draw(),momFruitCollision(),momBabyCollision(),wave.draw(),halo.draw(),data.draw()}function onMouseMove(t){data.gameOver||(t.offsetX||t.layerX)&&(mx=void 0==t.offsetX?t.layerX:t.offsetX,my=void 0==t.offsetY?t.layerY:t.offsetY)}function calLength2(t,a,i,e){return Math.pow(t-i,2)+Math.pow(a-e,2)}function randomColor(){var t=[0,1,2];t[0]=100*Math.random()+155,t[0]=t[0].toFixed(),t[1]=100*Math.random()+155,t[1]=t[1].toFixed(),t[2]=100*Math.random()+155,t[2]=t[2].toFixed();var a=Math.floor(3*Math.random());return t[a]=0,"rgba("+t[0]+","+t[1]+","+t[2]+","}function lerpAngle(t,a,i){var e=a-t;return e>Math.PI&&(e-=2*Math.PI),e<-Math.PI&&(e+=2*Math.PI),t+e*i}function lerpDistance(t,a,i){var e=a-t;return t+e*i}function inOboundary(t,a,i,e,o,n){return t>i&&t<e&&a>o&&a<n}function rgbColor(t,a,i){return t=Math.round(256*t),a=Math.round(256*a),i=Math.round(256*i),"rgba("+t+","+a+","+i+",1)"}function rgbNum(t,a,i){return t=Math.round(256*t),a=Math.round(256*a),i=Math.round(256*i),"rgba("+t+","+a+","+i}function rnd(t){var a=t||1;return Math.random()*a}function rateRandom(t,a){for(var i=0,e=1;e<a-t;e++)i+=e;for(var o=Math.random()*i,e=1;e<a-t;e++)if(o-=e,o<0)return e-1+t}function distance(t,a,i,e,o){var n=Math.abs(t-i),r=Math.abs(a-e);return n<o&&r<o}function AABBbox(t,a,i,e,o,n,r){return A1=t.x+r,B1=t.x+a-r,C1=t.y+r,D1=t.y+i-r,A2=e.x+r,B2=e.x+o-r,C2=e.y+r,D2=e.y+n-r,!(A1>B2||B1<A2||C1>D2||D1<C2)}function dis2(t,a,i,e){var o=t-i,n=a-e;return o*o+n*n}function rndi2(t,a){var i=Math.random()*(a-t)+t;return Math.floor(i)}function drawBackground(){ctx2.drawImage(bgPic,0,0,canWidth,canHeight)}function fruitMonitor(){for(var t=0,a=0;a<fruit.num;a++)fruit.alive[a]&&t++;if(t<15)return void sendFruit()}function sendFruit(){for(var t=0;t<fruit.num;t++)if(!fruit.alive[t])return void fruit.born(t)}function momFruitCollision(){if(!data.gameOver)for(var t=0;t<fruit.num;t++)if(fruit.alive[t]){var a=calLength2(fruit.x[t],fruit.y[t],mom.x,mom.y);a<900&&(fruit.dead(t),data.fruitNum++,mom.momBodyCount++,mom.momBodyCount>7&&(mom.momBodyCount=7),"blue"===fruit.fruitType[t]?data.double=2:data.double=1,wave.born(fruit.x[t],fruit.y[t]))}}function momBabyCollision(){var t=calLength2(mom.x,mom.y,baby.x,baby.y);data.fruitNum>0&&!data.gameOver&&t<900&&(baby.babyBodyCount=0,mom.momBodyCount=0,data.addScore(),halo.born(baby.x,baby.y))}var can1,can2,ctx1,ctx2,bgPic=new Image,canWidth,canHeight,lastTime,deltaTime,mx,my,data,play_again_btn,ane,fruit,mom,baby,babyEye=[],babyBody=[],babyTail=[],momEye=[],momTail=[],momBodyBlue=[],momBodyOra=[],wave,halo,dust,dustPic=[];document.body.onload=game,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,a){return window.setTimeout(t,1e3/60)}}();var aneObj=function(){this.rootx=[],this.headx=[],this.heady=[],this.amp=[],this.alpha=0};aneObj.prototype.num=50,aneObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.rootx[t]=16*t+20*Math.random(),this.headx[t]=this.rootx[t],this.heady[t]=canHeight-250+50*Math.random(),this.amp[t]=50*Math.random()+50},aneObj.prototype.draw=function(){this.alpha+=8e-4*deltaTime;var t=Math.sin(this.alpha);ctx2.save(),ctx2.globalAlpha=.6,ctx2.lineWidth=20,ctx2.lineCap="round",ctx2.strokeStyle="#3b154e";for(var a=0;a<this.num;a++)ctx2.beginPath(),this.headx[a]=this.rootx[a]+this.amp[a]*t,ctx2.moveTo(this.rootx[a],canHeight),ctx2.quadraticCurveTo(this.rootx[a],canHeight-100,this.headx[a],this.heady[a]),ctx2.stroke();ctx2.restore()};var fruitObj=function(){this.alive=[],this.x=[],this.y=[],this.l=[],this.aneNO=[],this.spd=[],this.fruitType=[],this.orange=new Image,this.blue=new Image};fruitObj.prototype.num=30,fruitObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.alive[t]=!1,this.x[t]=0,this.y[t]=0,this.l[t]=0,this.spd[t]=.017*Math.random()+.003,this.fruitType[t]="";this.orange.src="assets/imgs/fruit.png",this.blue.src="assets/imgs/blue.png"},fruitObj.prototype.draw=function(){for(var t=0;t<this.num;t++)if(this.alive[t]){if("orange"==this.fruitType[t])var a=this.orange;else var a=this.blue;this.l[t]<=14?(this.l[t]+=this.spd[t]*deltaTime,this.x[t]=ane.headx[this.aneNO[t]],this.y[t]=ane.heady[this.aneNO[t]]):this.y[t]-=7*this.spd[t]*deltaTime,ctx2.drawImage(a,this.x[t]-.5*this.l[t],this.y[t]-.5*this.l[t],this.l[t],this.l[t]),this.y[t]<10&&(this.alive[t]=!1)}},fruitObj.prototype.born=function(t){this.aneNO[t]=Math.floor(Math.random()*ane.num),this.l[t]=0,this.alive[t]=!0;var a=Math.random();a<.7?this.fruitType[t]="orange":this.fruitType[t]="blue"},fruitObj.prototype.dead=function(t){this.alive[t]=!1};var momObj=function(){this.x,this.y,this.angle,this.momTailTimer=0,this.momTailCount=0,this.momEyeTimer=0,this.momEyeCount=0,this.momEyeInterval=1e3,this.momBodyCount=0};momObj.prototype.init=function(){this.x=.5*canWidth,this.y=.5*canHeight,this.angle=0,this.momBodyCount=0},momObj.prototype.draw=function(){this.x=lerpDistance(mx,this.x,.99),this.y=lerpDistance(my,this.y,.99);var t=my-this.y,a=mx-this.x,i=Math.atan2(t,a)+Math.PI;this.angle=lerpAngle(i,this.angle,.6),this.momTailTimer+=deltaTime,this.momTailTimer>50&&(this.momTailCount=(this.momTailCount+1)%8,this.momTailTimer%=50),this.momEyeTimer+=deltaTime,this.momEyeTimer>this.momEyeInterval&&(this.momEyeCount=(this.momEyeCount+1)%2,this.momEyeTimer%=this.momEyeInterval,0===this.momEyeCount?this.momEyeInterval=1500*Math.random()+2e3:this.momEyeInterval=200),ctx1.save(),ctx1.translate(this.x,this.y),ctx1.rotate(this.angle);var e=this.momTailCount,o=this.momEyeCount,n=this.momBodyCount;ctx1.drawImage(momEye[o],.5*-momEye[o].width,.5*-momEye[o].height),1===data.double?ctx1.drawImage(momBodyOra[n],.5*-momBodyOra[n].width,.5*-momBodyOra[n].height):ctx1.drawImage(momBodyBlue[n],.5*-momBodyBlue[n].width,.5*-momBodyBlue[n].height),ctx1.drawImage(momTail[e],.5*-momTail[e].width+30,.5*-momTail[e].height),ctx1.restore()};var babyObj=function(){this.x,this.y,this.angle,this.babyTailTimer=0,this.babyTailCount=0,this.babyEyeTimer=0,this.babyEyeCount=0,this.babyEyeInterval=1e3,this.babyBodyTimer=0,this.babyBodyCount=0};babyObj.prototype.init=function(){this.x=.5*canWidth-50,this.y=.5*canHeight-50,this.angle=0,this.babyBodyCount=0},babyObj.prototype.draw=function(){this.x=lerpDistance(mom.x,this.x,.98),this.y=lerpDistance(mom.y,this.y,.98);var t=mom.y-this.y,a=mom.x-this.x,i=Math.atan2(t,a)+Math.PI;this.angle=lerpAngle(i,this.angle,.6),this.babyTailTimer+=deltaTime,this.babyTailTimer>50&&(this.babyTailCount=(this.babyTailCount+1)%8,this.babyTailTimer%=50),this.babyEyeTimer+=deltaTime,this.babyEyeTimer>this.babyEyeInterval&&(this.babyEyeCount=(this.babyEyeCount+1)%2,this.babyEyeTimer%=this.babyEyeInterval,0===this.babyEyeCount?this.babyEyeInterval=1500*Math.random()+2e3:this.babyEyeInterval=200),this.babyBodyTimer+=deltaTime,this.babyBodyTimer>300&&(this.babyBodyCount+=1,this.babyBodyTimer%=300,this.babyBodyCount>19&&(this.babyBodyCount=19,data.gameOver=!0,play_again_show())),ctx1.save(),ctx1.translate(this.x,this.y),ctx1.rotate(this.angle);var e=this.babyTailCount,o=this.babyEyeCount,n=this.babyBodyCount;ctx1.drawImage(babyTail[e],.5*-babyTail[e].width+23,.5*-babyTail[e].height),ctx1.drawImage(babyBody[n],.5*-babyBody[n].width,.5*-babyBody[n].height),ctx1.drawImage(babyEye[o],.5*-babyEye[o].width,.5*-babyEye[o].height),ctx1.restore()};var dataObj=function(){this.fruitNum=0,this.double=1,this.score=0,this.gameOver=!1,this.alpha=0};dataObj.prototype.reset=function(){this.fruitNum=0,this.double=1,this.score=0,this.gameOver=!1,this.alpha=0},dataObj.prototype.draw=function(){var t=can1.width,a=can1.height;ctx1.save(),ctx1.shadowBlur=10,ctx1.shadowColor="white",ctx1.fillStyle="white",ctx1.fillText("SCORE:"+this.score,.5*t,a-20),this.gameOver&&(this.alpha+=5e-4*deltaTime,this.alpha>=1&&(this.alpha=1),ctx1.fillStyle="rgba(255,255,255,"+this.alpha+")",ctx1.fillText("GAME OVER",.5*t,.5*a)),ctx1.restore()},dataObj.prototype.addScore=function(){this.score+=100*this.fruitNum*this.double,this.fruitNum=0,this.double=1};var waveObj=function(){this.x=[],this.y=[],this.alive=[],this.r=[]};waveObj.prototype.num=10,waveObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.alive[t]=!1,this.r[t]=0},waveObj.prototype.draw=function(){ctx1.save(),ctx1.lineWidth=2,ctx1.shadowBlur=10,ctx1.shadowColor="white";for(var t=0;t<this.num;t++)if(this.alive[t]){if(this.r[t]+=.04*deltaTime,this.r[t]>50){this.alive[t]=!1;break}var a=1-this.r[t]/50;ctx1.beginPath(),ctx1.arc(this.x[t],this.y[t],this.r[t],0,2*Math.PI),ctx1.closePath(),ctx1.strokeStyle="rgba(255,255,255,"+a+")",ctx1.stroke()}ctx1.restore()},waveObj.prototype.born=function(t,a){for(var i=0;i<this.num;i++)if(!this.alive[i])return this.x[i]=t,this.y[i]=a,this.alive[i]=!0,void(this.r[i]=10)};var haloObj=function(){this.x=[],this.y=[],this.alive=[],this.r=[]};haloObj.prototype.num=5,haloObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.x[t]=0,this.y[t]=0,this.alive[t]=!1,this.r[t]=0},haloObj.prototype.draw=function(){ctx1.save(),ctx1.lineWidth=2,ctx1.shadowBlur=10,ctx1.shadowColor="rgba(203.91.0,1)";for(var t=0;t<this.num;t++)if(this.alive[t]){if(this.r[t]+=.05*deltaTime,this.r[t]>100){this.alive[t]=!1;break}var a=1-this.r[t]/100;ctx1.beginPath(),ctx1.arc(this.x[t],this.y[t],this.r[t],0,2*Math.PI),ctx1.closePath(),ctx1.strokeStyle="rgba(203,91,0,"+a+")",ctx1.stroke()}ctx1.restore()},haloObj.prototype.born=function(t,a){for(var i=0;i<this.num;i++)this.alive[i]||(this.x[i]=t,this.y[i]=a,this.alive[i]=!0,this.r[i]=10)};var dustObj=function(){this.x=[],this.y=[],this.amp=[],this.NO=[],this.alpha};dustObj.prototype.num=30,dustObj.prototype.init=function(){for(var t=0;t<this.num;t++)this.x[t]=Math.random()*canWidth,this.y[t]=Math.random()*canHeight,this.amp[t]=20+25*Math.random(),this.NO[t]=Math.floor(7*Math.random());this.alpha=0},dustObj.prototype.draw=function(){this.alpha+=8e-4*deltaTime;for(var t=Math.sin(this.alpha),a=0;a<this.num;a++){var i=this.NO[a];ctx2.drawImage(dustPic[i],this.x[a]+this.amp[a]*t,this.y[a])}};